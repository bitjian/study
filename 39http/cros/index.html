<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div>HELLO</div>
    <script>
      // function fn(message) {
      //   console.log(message);
      //   alert(message)
      // }
      // 使用 后端响应头支持跨域请求
      // fetch("http://localhost:91/").then(res => {
      //   console.log(res);
      //   return res.text()
      // }).then(res => {
      //   alert(res)
      // })
      // 封装一个跨域请求
      function myJsonp({url, callback, params} ) {
        return new Promise((resolve, reject) => {
          const script = document.createElement('script')
          window[callback] = function (data) {
            resolve(data)
            document.body.removeChild(script)
          }
          const paramsObj = {...params, callback}
          let paramsArr = []
          for(key in paramsObj) {
            paramsArr.push(`${key}=${paramsObj[key]}`)
          }
          script.src= `${url}?${paramsArr.join('&')}`
          document.body.appendChild(script)
        })
      }
      myJsonp({url:"http://localhost:91", callback:'fn', params:{message: '你好呀'} }).then(data => console.log(data))
    </script>
  </body>
  <!-- 通过jsonp访问跨域请求 -->
  <!-- <script src="http://localhost:91?callback=fn" ></script> -->
</html>
